<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <title>Dashboard</title>
    <style>
        #body{
            margin: 0;
            padding: 0;
        }
        #app{
            width: 100%;
            height: 100%;
            max-width: 100vw;
            max-height: 100vh;
            padding: 20px;
        }
        #app h1{
            text-align: center;
        }
        #app .actual-orator{
            width: 100%;
            height: auto;
            max-width: 900px;
        }
        #app .add-orator{
            width: 100%;
            height: auto;
            max-width: 900px;
        }
    </style>
</head>
<body>
    <div id="app">
        <h1 id="meet-title">Hello World</h1>
        <section class="add-orator">
            <form id="add-orator-form" class="row gy-2 gx-3 align-items-center">
                <h3>Adicionar orador</h3>
                <div class="col-auto">
                  <div class="input-group">
                    <div class="input-group-text">Nome</div>
                    <input type="text" class="form-control" id="orator-name-add">
                  </div>
                </div>
                <div class="col-auto">
                  <div class="input-group">
                    <div class="input-group-text">Chamado</div>
                    <input type="text" class="form-control" id="orator-role-add">
                  </div>
                </div>
                <div class="col-auto">
                  <button type="submit" class="btn btn-primary">Adicionar Orador</button>
                </div>
              </form>
        </section>
        <section class="add-music">
            <form id="add-music-form" class="row gy-2 gx-3 align-items-center">
                <h3>Adicionar Hino</h3>
                <div class="col-auto">
                  <div class="input-group">
                    <div class="input-group-text">Nome</div>
                    <input type="text" class="form-control" id="music-name-add">
                  </div>
                </div>
                <div class="col-auto">
                  <div class="input-group">
                    <div class="input-group-text">Página</div>
                    <input type="text" class="form-control" id="music-page-add">
                  </div>
                </div>
                <div class="col-auto">
                  <button type="submit" class="btn btn-primary">Adicionar Hino</button>
                </div>
              </form>
        </section>

        <section class="actual-orator">
            <form class="row gy-2 gx-3 align-items-center" id="actual-orator-form">
                <h3>Orador atual</h3>
                <div class="col-auto">
                    <select id="select-orators" class="form-select" aria-label="Default select example">
                    </select>
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">Selecionar</button>
                </div>
            </form>
        </section>
        
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>

        //list

        let oratorslength = 0;

        const orators = document.querySelector("#select-orators");
        let optionDefault = document.createElement("option");

        let oratorsList;

        axios.get('/orators')
            .then((response) => {
                
                if (response.status != 200) {
                    return;
                }
                if (!response.data.length) {
                    let option = document.createElement("option");
                    option.setAttribute("value", "");
                    option.innerHTML = "Cadastre um orador antes!";
                    orators.append(option);
                    orators.disabled = true;
                    return;
                }

                let activeOrator = false;
                oratorslength = response.data.length;
                oratorsList = response.data;
                
                response.data.map((orator) => {
                    if(orator.active){
                        activeOrator = true;
                    }
                });


                for (let i = 0; i < response.data.length; i++) {
                    let option = document.createElement("option");

                    if(!activeOrator && i == 0){
                        optionDefault.setAttribute("value", "");
                        optionDefault.innerHTML = "Selecione uma opção";
                        optionDefault.setAttribute("selected","");
                        orators.append(optionDefault);
                    }

                    option.setAttribute("value", `${response.data[i].id}`);
                    option.innerHTML = `${response.data[i].name} - ${response.data[i].role}`;
                    if(response.data[i].active){
                        option.setAttribute("selected", "");
                    }
                    orators.append(option);

                }
            })
            .catch((error) => {
                console.log(error);
            });




        //add

        const addOratorForm = document.querySelector("#add-orator-form");
        let oratorName = document.querySelector("#orator-name-add");
        let oratorRole = document.querySelector("#orator-role-add");

        addOratorForm.addEventListener("submit", (event) => {
            event.preventDefault();
            axios.post('/orators', {
                id: oratorsLength,
                name: oratorName.value,
                role: oratorRole.value
            }).then((response) => {
                console.log(response);
                alert("Orador cadastrado com sucesso!");
                document.location.reload(true);
            }).catch((error) => {
                console.log(error);
            });
        });

        //change actual-orator

        const actualOrator = document.querySelector("#actual-orator-form");
        let oratorChange;
        actualOrator.addEventListener("submit", (event) => {
            event.preventDefault();
            console.log(orators.value);
            console.log(oratorsList[orators.value].name);
            console.log(oratorsList[orators.value].role);
            axios.put(`/orators/${orators.value}`, {
                name: oratorsList[orators.value].name,
                role: oratorsList[orators.value].role,
                active: true
            }).then((response) => {
                console.log(response);
                alert("Orador atual modificado com sucesso!");
                document.location.reload(true);
            }).catch((error) => {
                console.log(error);
            });
        });

        //music
        let musicslength;
        let musicsList;
        axios.get('/musics')
            .then((response) => {
                
                if (response.status != 200) {
                    return;
                }
               
                musicslength = response.data.length;
                musicsList = response.data;
                
                
            })
            .catch((error) => {
                console.log(error);
            });



        //add music

        const addMusicForm = document.querySelector("#add-music-form");
        let musicName = document.querySelector("#music-name-add");
        let musicPage = document.querySelector("#music-page-add");

        addMusicForm.addEventListener("submit", (event) => {
            event.preventDefault();
            axios.post('/musics', {
                id: musicslength,
                name: musicName.value,
                page: musicPage.value
            }).then((response) => {
                console.log(response);
                alert("Hino cadastrado com sucesso!");
                document.location.reload(true);
            }).catch((error) => {
                console.log(error);
            });
        });
        

    </script>
</body>

</html>